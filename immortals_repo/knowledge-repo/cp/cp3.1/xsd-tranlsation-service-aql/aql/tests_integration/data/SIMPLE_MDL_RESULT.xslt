<?xml version='1.0' encoding='utf-8'?>
<xsl:stylesheet xmlns:mdl="http://inetprogram.org/projects/MDL" xmlns:my="http://233analytics.com/my" xmlns:tmats="https://wsmrc2vger.wsmr.army.mil/rcc/manuals/106-11" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns="http://www.w3.org/1999/xhtml" version="2.0">
  <xsl:function as="xsd:string" name="my:gen-id">
    <xsl:sequence select="generate-id(my:gen-id-getnode())"/>
  </xsl:function>
  <xsl:function as="element()" name="my:gen-id-getnode">
    <node/>
  </xsl:function>
  <!-- identity template, copies everything as is -->
  <xsl:template match="@*|node()">
    <xsl:copy>
      <xsl:apply-templates select="@*|node()"/>
    </xsl:copy>
  </xsl:template>
  <xsl:template match="/mdl:MDLRoot/@xsi:schemaLocation">
    <xsl:attribute name="xsi:schemaLocation">http://inetprogram.org/projects/MDL MDL19.xsd</xsl:attribute>
  </xsl:template>
  <!-- Reordering children elements of "/MDLRoot/NetworkDomains"-->
  <xsl:template match="/mdl:MDLRoot/mdl:NetworkDomains">
    <xsl:element name="mdl:NetworkDomains">
      <xsl:copy-of select="mdl:ReadOnly"/>
      <xsl:copy-of select="mdl:Owner"/>
      <xsl:copy-of select="mdl:Network"/>
    </xsl:element>
  </xsl:template>
  <!-- Add node "/MDLRoot/IPV4" -->
  <xsl:template match="/mdl:MDLRoot">
    <xsl:copy>
      <xsl:apply-templates select="@*|node()"/>
      <xsl:comment>Element "IPV4" choosed from choices group</xsl:comment>
      <xsl:element name="IPV4" namespace="http://inetprogram.org/projects/MDL">autogenerated</xsl:element>
    </xsl:copy>
  </xsl:template>
  <!-- Add node "/MDLRoot/NetworkDomains/Domain" -->
  <xsl:template match="/mdl:MDLRoot/mdl:NetworkDomains">
    <xsl:copy>
      <xsl:apply-templates select="@*|node()"/>
      <xsl:element name="Domain" namespace="http://inetprogram.org/projects/MDL">autogenerated</xsl:element>
    </xsl:copy>
  </xsl:template>
  <!-- Add node "/MDLRoot/NetworkDomains/Network/NetworkNode/InternalStructure" -->
  <xsl:template match="/mdl:MDLRoot/mdl:NetworkDomains/mdl:Network/mdl:NetworkNode">
    <xsl:copy>
      <xsl:apply-templates select="@*|node()"/>
      <xsl:element name="InternalStructure" namespace="http://inetprogram.org/projects/MDL">
        <xsl:element name="Module" namespace="http://inetprogram.org/projects/MDL">
          <xsl:attribute name="ID">
            <xsl:value-of select="my:gen-id()"/>
          </xsl:attribute>
          <xsl:element name="Name" namespace="http://inetprogram.org/projects/MDL">autogenerated</xsl:element>
          <xsl:element name="Description" namespace="http://inetprogram.org/projects/MDL">autogenerated</xsl:element>
          <xsl:if test="/mdl:MDLRoot/mdl:NetworkDomains/mdl:Network/mdl:NetworkNode/mdl:Routes">
            <xsl:copy-of select="/mdl:MDLRoot/mdl:NetworkDomains/mdl:Network/mdl:NetworkNode/mdl:Routes"/>
          </xsl:if>
          <xsl:if test="not(/mdl:MDLRoot/mdl:NetworkDomains/mdl:Network/mdl:NetworkNode/mdl:Routes)">
            <xsl:element name="Routes" namespace="http://inetprogram.org/projects/MDL">
              <xsl:element name="Route" namespace="http://inetprogram.org/projects/MDL"/>
            </xsl:element>
          </xsl:if>
        </xsl:element>
      </xsl:element>
    </xsl:copy>
  </xsl:template>
  <!-- Renaming element "/MDLRoot/ConfigurationVersion" to "ConfigVersion"-->
  <xsl:template match="/mdl:MDLRoot/mdl:ConfigurationVersion">
    <xsl:element name="mdl:ConfigVersion">
      <xsl:apply-templates select="@*|node()"/>
    </xsl:element>
  </xsl:template>
  <!-- handle removals-->
  <xsl:template match="/mdl:MDLRoot/mdl:DatabaseID"/>
  <xsl:template match="/mdl:MDLRoot/mdl:NetworkDomains/mdl:Network/mdl:NetworkNode/mdl:NetworkName"/>
  <xsl:template match="/mdl:MDLRoot/mdl:NetworkDomains/mdl:Network/mdl:NetworkNode/mdl:Routes"/>
  <!-- Moving element from "/MDLRoot/DatabaseID" to "/MDLRoot/NetworkDomains/DatabaseID"-->
  <xsl:template match="/mdl:MDLRoot/mdl:DatabaseID"/>
  <xsl:template match="/mdl:MDLRoot/mdl:NetworkDomains">
    <xsl:copy>
      <xsl:apply-templates select="@*|node()"/>
      <xsl:copy-of select="/mdl:MDLRoot/mdl:DatabaseID"/>
    </xsl:copy>
  </xsl:template>
</xsl:stylesheet>
